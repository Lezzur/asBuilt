## Output Format: AS_BUILT_AGENT.md

Produce a dense, technically precise markdown document optimized for AI agent consumption. AI coding assistants (Claude Code, Cursor, GitHub Copilot) will ingest this as their primary project context. Density and precision are features — this is a reference document, not a narrative.

### Mandatory Document Structure

The document MUST contain these sections IN THIS ORDER. Do not skip, reorder, or rename sections.

```
# AS_BUILT_AGENT.md — {Project Name}
> Generated by as_built | {date}
> This document is optimized for AI agent consumption.

## Table of Contents
(auto-generated from sections below)

## 1. Project Overview
## 2. Tech Stack & Dependencies
## 3. Architecture
## 4. Directory Map
## 5. Data Model
## 6. API Surface
## 7. Core Modules
## 8. Authentication & Authorization
## 9. Configuration & Environment
## 10. Error Handling
## 11. Current State & TODOs
## 12. Security Notes
## 13. Terminology
```

### Section Requirements

**§1 Project Overview** — 3-5 sentences. What this project does, its core purpose, and its primary output. No marketing language. State facts.

**§2 Tech Stack & Dependencies** — Table format:
| Category | Technology | Version | Purpose |
Use exact versions from package.json/requirements.txt/etc.

**§3 Architecture** — Describe the overall pattern. Include a text-based flow diagram of the primary data path:
```
User Input → API Route → Service Layer → Database
                      ↳ Background Job → LLM → Output
```
List all architectural layers and how they interact.

**§4 Directory Map** — For each top-level directory, a one-line description of its contents. For important directories, list key files with one-line descriptions.

**§5 Data Model** — For each database collection/table:
- Field name, type, purpose, constraints.
- Relationships to other collections/tables.
- Use TypeScript interface notation or equivalent.

**§6 API Surface** — For each endpoint:
```
METHOD /path — Brief description
  Auth: required | public
  Params: { key: type }
  Body: { key: type }
  Response: { key: type }
  Errors: 400 (why), 401 (why), 404 (why)
```

**§7 Core Modules** — For each module (file or directory that contains business logic):
- Purpose (one sentence).
- Public exports with signatures: `functionName(param: Type): ReturnType`
- Dependencies: what it imports and from where.
- Key behavior notes (side effects, async patterns, state mutations).

**§8 Authentication & Authorization** — Auth mechanism, token format, storage, validation flow. Permission model. Protected vs. public routes.

**§9 Configuration & Environment** — Table of all environment variables:
| Variable | Required | Default | Description |
Plus build commands, dev server setup, deployment config.

**§10 Error Handling** — Retry strategies, error boundaries, fallback patterns, user-facing error messages. Cite specific files.

**§11 Current State & TODOs** — What is complete, what is stubbed, what is broken. List all TODO/FIXME/HACK comments with file paths and line numbers.

**§12 Security Notes** — Secrets handling, encryption, data privacy patterns. Flag any concerns.

**§13 Terminology** — Project-specific terms with definitions.

### Formatting Rules for Agent Output
- ALWAYS include file paths in the format `path/to/file.ts:lineNumber` when referencing code.
- Use code blocks (```) for interfaces, schemas, config objects, function signatures.
- Use tables for structured data (dependencies, env vars, API endpoints).
- Prefer explicit over implicit: write `userId: string (Firebase Auth UID, used as document ID)` not just `userId: string`.
- Cross-reference between sections: "See §5 Data Model for the full schema" or "Defined in §7 Core Modules > auth.ts".
- Every section must have content. If not applicable, write "N/A — [reason]".
